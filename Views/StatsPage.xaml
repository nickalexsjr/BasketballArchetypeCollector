<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BasketballArchetypeCollector.ViewModels"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="BasketballArchetypeCollector.Views.StatsPage"
             x:DataType="vm:StatsViewModel"
             BackgroundColor="#0f172a"
             Shell.NavBarIsVisible="False"
             ios:Page.UseSafeArea="True">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- Header -->
            <VerticalStackLayout>
                <Label Text="STATS"
                       FontFamily="OrbitronBlack"
                       FontSize="24"
                       TextColor="#f97316" />
                <Label Text="Your collection statistics"
                       FontFamily="InterRegular"
                       FontSize="12"
                       TextColor="#94a3b8" />
            </VerticalStackLayout>

            <!-- Main Stats Grid -->
            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                <!-- Coins -->
                <Border Grid.Row="0" Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#1e293b"
                        Padding="16">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding Coins}"
                               FontFamily="OrbitronBold"
                               FontSize="28"
                               TextColor="#facc15"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Coins"
                               FontFamily="InterRegular"
                               FontSize="12"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Packs Opened -->
                <Border Grid.Row="0" Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#1e293b"
                        Padding="16">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding PacksOpened}"
                               FontFamily="OrbitronBold"
                               FontSize="28"
                               TextColor="White"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Packs Opened"
                               FontFamily="InterRegular"
                               FontSize="12"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Cards Collected -->
                <Border Grid.Row="1" Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#1e293b"
                        Padding="16">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding CardsCollected}"
                               FontFamily="OrbitronBold"
                               FontSize="28"
                               TextColor="White"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Cards Collected"
                               FontFamily="InterRegular"
                               FontSize="12"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Crests Generated -->
                <Border Grid.Row="1" Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#1e293b"
                        Padding="16">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding CrestsGenerated}"
                               FontFamily="OrbitronBold"
                               FontSize="28"
                               TextColor="#a855f7"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Crests Generated"
                               FontFamily="InterRegular"
                               FontSize="12"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Rarity Breakdown -->
            <Label Text="Rarity Breakdown"
                   FontFamily="InterSemiBold"
                   FontSize="16"
                   TextColor="White"
                   Margin="0,8,0,0" />

            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                <!-- GOAT -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#DC143C33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding GoatCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#DC143C"
                               HorizontalTextAlignment="Center" />
                        <Label Text="GOAT"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#DC143C"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Legendary -->
                <Border Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#FFD70033"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding LegendaryCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#FFD700"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Legendary"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#FFD700"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Epic -->
                <Border Grid.Column="2"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#9B59B633"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding EpicCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#9B59B6"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Epic"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#9B59B6"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Rare -->
                <Border Grid.Column="3"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#3498DB33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding RareCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#3498DB"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Rare"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#3498DB"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Second Row Rarities -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                <!-- Uncommon -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#2ECC7133"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding UncommonCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#2ECC71"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Uncommon"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#2ECC71"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Common -->
                <Border Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#7F8C8D33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding CommonCount}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#7F8C8D"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Common"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#7F8C8D"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Pack Purchase Stats (only when logged in) -->
            <Label Text="Pack Purchases"
                   FontFamily="InterSemiBold"
                   FontSize="16"
                   TextColor="White"
                   Margin="0,8,0,0"
                   IsVisible="{Binding IsLoggedIn}" />

            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="8"
                  IsVisible="{Binding IsLoggedIn}">
                <!-- Standard Packs -->
                <Border Grid.Row="0" Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#47556933"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding StandardPacksBought}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Standard"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#94a3b8"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Premium Packs -->
                <Border Grid.Row="0" Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#2563eb33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding PremiumPacksBought}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#3b82f6"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Premium"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#3b82f6"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Elite Packs -->
                <Border Grid.Row="1" Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#9333ea33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding ElitePacksBought}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#a855f7"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Elite"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#a855f7"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Legendary Packs -->
                <Border Grid.Row="1" Grid.Column="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="#f59e0b33"
                        Padding="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="{Binding LegendaryPacksBought}"
                               FontFamily="OrbitronBold"
                               FontSize="22"
                               TextColor="#f59e0b"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Legendary"
                               FontFamily="InterSemiBold"
                               FontSize="10"
                               TextColor="#f59e0b"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Purchase Summary -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#111827"
                    Padding="16"
                    Margin="0,8,0,0"
                    IsVisible="{Binding IsLoggedIn}">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Purchase Summary"
                           FontFamily="InterSemiBold"
                           FontSize="14"
                           TextColor="#64748b" />
                    <Label Text="{Binding TotalCoinsSpent, StringFormat='Total Coins Spent: {0:N0}'}"
                           FontFamily="InterRegular"
                           FontSize="14"
                           TextColor="#facc15" />
                    <Label Text="{Binding FavoritePackType, StringFormat='Favorite Pack: {0}'}"
                           FontFamily="InterRegular"
                           FontSize="14"
                           TextColor="White" />
                </VerticalStackLayout>
            </Border>

            <!-- Database Info -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#111827"
                    Padding="16"
                    Margin="0,8,0,0">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Database Info"
                           FontFamily="InterSemiBold"
                           FontSize="14"
                           TextColor="#64748b" />
                    <Label Text="{Binding TotalPlayers, StringFormat='Total Players: {0}'}"
                           FontFamily="InterRegular"
                           FontSize="14"
                           TextColor="White" />
                    <Label Text="{Binding CollectionPercent, StringFormat='Collection Progress: {0:F1}%'}"
                           FontFamily="InterRegular"
                           FontSize="14"
                           TextColor="White" />
                </VerticalStackLayout>
            </Border>

            <!-- Account Section -->
            <Label Text="Account"
                   FontFamily="InterSemiBold"
                   FontSize="16"
                   TextColor="White"
                   Margin="0,16,0,0" />

            <!-- Logged In State -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#1e293b"
                    Padding="16"
                    IsVisible="{Binding IsLoggedIn}">
                <VerticalStackLayout Spacing="12">
                    <HorizontalStackLayout Spacing="12">
                        <Border StrokeShape="RoundRectangle 25"
                                BackgroundColor="#3b82f6"
                                WidthRequest="50"
                                HeightRequest="50">
                            <Label Text="ðŸ‘¤"
                                   FontSize="24"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="{Binding UserDisplayName}"
                                   FontFamily="InterSemiBold"
                                   FontSize="16"
                                   TextColor="White" />
                            <Label Text="{Binding UserEmail}"
                                   FontFamily="InterRegular"
                                   FontSize="12"
                                   TextColor="#94a3b8" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <Button Text="Sign Out"
                            Command="{Binding SignOutCommand}"
                            BackgroundColor="#334155"
                            TextColor="White"
                            FontFamily="InterSemiBold"
                            CornerRadius="8"
                            HeightRequest="44" />
                </VerticalStackLayout>
            </Border>

            <!-- Logged Out State -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#1e293b"
                    Padding="16"
                    IsVisible="{Binding IsLoggedIn, Converter={StaticResource InvertedBoolConverter}}">
                <Button Text="Sign In / Sign Up"
                        Command="{Binding SignInCommand}"
                        BackgroundColor="#3b82f6"
                        TextColor="White"
                        FontFamily="InterSemiBold"
                        CornerRadius="8"
                        HeightRequest="44" />
            </Border>

            <!-- Support Section -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#1e293b"
                    Padding="16"
                    Margin="0,8,0,0">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Need help?"
                           FontFamily="InterRegular"
                           FontSize="14"
                           TextColor="#94a3b8">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleSupportInfoCommand}" />
                        </Label.GestureRecognizers>
                    </Label>

                    <VerticalStackLayout Spacing="8" IsVisible="{Binding ShowSupportInfo}">
                        <Label Text="Contact support:"
                               FontFamily="InterRegular"
                               FontSize="12"
                               TextColor="#64748b" />
                        <Label Text="support@najdevelopments.com.au"
                               FontFamily="InterSemiBold"
                               FontSize="14"
                               TextColor="#3b82f6">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding CopyEmailCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="Tap to copy"
                               FontFamily="InterRegular"
                               FontSize="10"
                               TextColor="#475569" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Danger Zone (only when logged in) -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="#1c1917"
                    Stroke="#7f1d1d"
                    StrokeThickness="1"
                    Padding="16"
                    Margin="0,8,0,0"
                    IsVisible="{Binding IsLoggedIn}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Danger Zone"
                           FontFamily="InterSemiBold"
                           FontSize="14"
                           TextColor="#ef4444" />
                    <Button Text="Delete Account"
                            Command="{Binding DeleteAccountCommand}"
                            BackgroundColor="#7f1d1d"
                            TextColor="#fca5a5"
                            FontFamily="InterSemiBold"
                            CornerRadius="8"
                            HeightRequest="44" />
                </VerticalStackLayout>
            </Border>

            <!-- App Version -->
            <Label Text="Version 1.3.0"
                   FontFamily="InterRegular"
                   FontSize="12"
                   TextColor="#475569"
                   HorizontalTextAlignment="Center"
                   Margin="0,16,0,8" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
